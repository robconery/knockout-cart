ko.bindingHandlers.currency={update:function(c,d){var b=parseFloat(ko.utils.unwrapObservable(d()))||0;var a=function(){return"$"+b.toFixed(2)};ko.bindingHandlers.text.update(c,a)}};ko.bindingHandlers.clickWithData={init:function(b,d,f,c,a){var e=$(b).data(),g=d().bind(this,e);delete e.bind;ko.applyBindingsToNode(b,{click:g})}};ko.observable.fn.asPositiveInteger=function(a){var b=this,c=ko.computed({read:b,write:function(e){var d=parseInt(e,10);if(isNaN(d)||d<0){d=a}b(d)}});c(b());return c};var Tekpub=Tekpub||{};Tekpub.CartItem=function(b,d){var a={};var c=(b.quantity||1);a.price=b.price||0;a.quantity=ko.observable(c).asPositiveInteger(1);a.sku=b.sku||"";a.description=b.description||"";a.priceInPennies=function(){return a.price*100};a.subtotal=ko.computed(function(){return a.price*a.quantity()});a.discount=ko.computed(function(){return a.quantity()>=5?a.subtotal()*0.2:0});a.lineTotal=ko.computed(function(){return(a.price-a.discount())*a.quantity()});if(d){a.quantity.subscribe(function(e){d.call(a,a)})}return a};Tekpub.Cart=function(){var a=this;var b=JSON.parse(localStorage.getItem("tekpubCart"))||[];a.items=ko.observableArray();a.itemQuantityCheck=function(c){if(c&&c.quantity()===0){a.items.remove(c)}};a.items(ko.utils.arrayMap(b,function(c){return Tekpub.CartItem(c,a.itemQuantityCheck)}));a.addItem=function(e){var d=a.find(e.sku);var c=a.items();if(d){d.quantity(d.quantity()+parseInt(e.quantity||1,10))}else{d=Tekpub.CartItem(e,a.itemQuantityCheck);a.items.push(d)}return d};a.rowCount=function(){return a.items().length};a.remove=function(c){a.items.remove(function(d){return d.sku==c})};a.removeClicked=function(c){a.remove(c.sku)};a.itemCount=function(){var c=0;ko.utils.arrayForEach(a.items(),function(d){c+=d.quantity()});return c};a.total=function(){var c=0;ko.utils.arrayForEach(a.items(),function(d){c+=d.lineTotal()});return c};a.empty=function(){a.items([])};a.find=function(c){return ko.utils.arrayFirst(a.items(),function(d){return d.sku===c})};a.contains=function(c){return a.find(c)?true:false};ko.computed(function(){localStorage.setItem("tekpubCart",ko.toJSON(a.items))}).extend({throttle:1});a.hasItems=ko.computed(function(){return a.rowCount()>0});a.isNumber=function(c){return !isNaN(parseFloat(c))&&isFinite(c)};return a};